import{C as ie,S as se,a as ae,F as le,H as ce,D as re,M as de,P as fe,b as ue,G as pe,c as K,A as J,d as X,W as me,s as he,e as ge,O as we,f as ve,g as be,h as ye,i as ke,V as Z,j as Se,k as Ae,l as xe,m as Ce,B as Q,n as H,U as Fe,o as Me}from"./vendor.8704e2d3.js";const Le=function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))o(i);new MutationObserver(i=>{for(const s of i)if(s.type==="childList")for(const r of s.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&o(r)}).observe(document,{childList:!0,subtree:!0});function n(i){const s={};return i.integrity&&(s.integrity=i.integrity),i.referrerpolicy&&(s.referrerPolicy=i.referrerpolicy),i.crossorigin==="use-credentials"?s.credentials="include":i.crossorigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function o(i){if(i.ep)return;i.ep=!0;const s=n(i);fetch(i.href,s)}};Le();let h,v,F,G,M,j,L,I,Y;const D=[];let a=[],z=[];const B=new ie(5,5,5,5,15,5,30);let w;var A;let O=!1,R=0,T=.07,W="idle";const U=[],k={idle:{weight:0},walk:{weight:0},run:{weight:1}},_={sneak_pose:{weight:1},sad_pose:{weight:0},agree:{weight:0},headShake:{weight:0}};let E,V;_e();function _e(){const t=document.getElementById("container");Y=new ke,h=new se,h.background=new ae(10526880),h.fog=new le(10526880,10,50);const e=new ce(16777215,4473924);e.position.set(0,20,0),h.add(e);const n=new re(16777215);n.position.set(3,10,10),n.castShadow=!0,n.shadow.camera.top=2,n.shadow.camera.bottom=-2,n.shadow.camera.left=-2,n.shadow.camera.right=2,n.shadow.camera.near=.1,n.shadow.camera.far=40,h.add(n);const o=new de(new fe(100,100),new ue({color:10066329,depthWrite:!1}));o.rotation.x=-Math.PI/2,o.receiveShadow=!0,h.add(o),new pe().load("models/gltf/Xbot.glb",function(r){M=r.scene,M.position.x=1,h.add(M),M.traverse(function(u){u.isMesh&&(u.castShadow=!0)}),j=new K(M),j.visible=!1,h.add(j);const l=r.animations;I=new J(M),V=l.length;for(let u=0;u!==V;++u){let d=l[u];const b=d.name;if(k[b]){const m=I.clipAction(d);$(m),k[b].action=m,U.push(m)}else if(_[b]){X.makeClipAdditive(d),d.name.endsWith("_pose")&&(d=X.subclip(d,d.name,2,3,30));const m=I.clipAction(d);$(m),_[b].action=m,U.push(m)}}Be(),ze(),te()}),v=new me({antialias:!0}),v.setPixelRatio(window.devicePixelRatio),v.setSize(window.innerWidth,window.innerHeight),v.outputEncoding=he,v.shadowMap.enabled=!0,t.appendChild(v.domElement),F=new ge(45,window.innerWidth/window.innerHeight,1,100),F.position.set(-1,2,5);const s=new we(F,v.domElement);s.enablePan=!1,s.enableZoom=!0,s.target.set(0,1,0),s.update(),G=new ve,t.appendChild(G.dom),window.addEventListener("resize",Ge)}function Ee(t,e){const n=a[0][0].length,o=120,i=n/o;var s=[];const r=[],l=[],u=new H;for(let f=0;f<n;f++){r.push(f/o);let x=a[0][0][f],S=a[1][0][f],c=a[2][0][f];u.set(x,S,c).toArray(l,l.length)}const d=".bones[bone_0].position",b=new Z(d,r,l);s.push(b);for(let f=1;f<a[0].length;f++){const x=[],S=[],c=new H;for(let p=0;p<n;p++){x.push(p/o);let C=t[f-1],P=e[f-1],N=a[0][P][p]-a[0][C][p],ne=a[1][P][p]-a[1][C][p],oe=a[2][P][p]-a[2][C][p];c.set(N,ne,oe).toArray(S,S.length)}const g=".bones[bone_"+f+"].position",y=new Z(g,x,S);s.push(y)}var m=new Se("Action",i,s);L=new J(w),A=L.clipAction(m),A.play()}function Pe(){const t=B.attributes.position,e=new H,n=[],o=[];for(let i=0;i<t.count;i++){e.fromBufferAttribute(t,i);const s=1,r=1;n.push(s,s+1,0,0),o.push(1-r,r,0,0)}B.setAttribute("skinIndex",new Fe(n,4)),B.setAttribute("skinWeight",new Me(o,4))}function We(){Pe();const t=new Ae({color:16737095,wireframe:!0});w=new xe(B,t);const e=new Ce(z),n=e.bones[0];w.add(n),w.visible=!1,w.bind(e),w.position.set(0,1.15,0),w.scale.set(T,T,T),h.add(w);var o=new K(w);o.material.linewidth=1,o.visible=!0,h.add(o)}function Ie(t,e,n){let o=new Q;o.name="bone_0",z.push(o);let i=a[0][0][0],s=a[1][0][0],r=a[2][0][0];o.position.set(i,s,r),console.log(o.position),console.log(a[2][2][2033]),console.log(a[0][1][0]);for(let l=1;l!==t.length+1;++l){let u=new Q;z[t[l-1]].add(u),u.name="bone_"+e[l-1],z.push(u),console.log(l);let d=t[l-1];i=a[0][l][0]-a[0][d][0],s=a[1][l][0]-a[1][d][0],r=a[2][l][0]-a[2][d][0],u.position.set(i,s,r)}}function ze(){new be().load("models/files/output.json",function(e){a=JSON.parse(e);const n=[a.length,a[0].length,a[0][0].length];if(console.log(n),n[1]!==12)var o=[0,1,2,3,4,5,0,7,8,9,10,11,0,13,14,15,16,17,18,15,20,21,22,23,24,25,23,27,15,29,30,31,32,33,34,32,36],i=[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37];Ie(o,i),We(),Ee(o,i)},function(e){console.log(e.loaded/e.total*100+"% loaded")},function(e){console.error("An error happened")})}function Be(){const t=new ye({width:310}),e=t.addFolder("Base Actions"),n=t.addFolder("Activation/Deactivation"),o=t.addFolder("Additive Action Weights"),i=t.addFolder("General Speed"),s=t.addFolder("Scale and Pos");E={"modify time scale":1};const r=["None",...Object.keys(k)];for(let c=0,g=r.length;c!==g;++c){const y=r[c],p=k[y];E[y]=function(){const C=k[W],P=C?C.action:null,N=p?p.action:null;Ne(P,N,.35)},D.push(e.add(E,y))}const l={"deactivate all":u,"activate all":d,"pause/continue":b,"make single step":x,"modify step size":.05,"set mesh scale":.07};n.add(l,"deactivate all"),n.add(l,"activate all"),n.add(l,"pause/continue"),n.add(l,"make single step"),n.add(l,"modify step size",.01,.1,.001),s.add(l,"set mesh scale",.01,1,.01).onChange(S);function u(){A.stop()}function d(){A.play()}function b(){O?(O=!1,f()):A.paused?f():m()}function m(){A.paused=!0}function f(){A.paused=!1}function x(){f(),O=!0,R=l["modify step size"]}function S(c){w.scale.set(c,c,c)}for(const c of Object.keys(_)){const g=_[c];E[c]=g.weight,o.add(E,c,0,1,.01).listen().onChange(function(y){q(g.action,y),g.weight=y})}i.add(E,"modify time scale",0,1.5,.01).onChange(Oe),e.open(),n.open(),o.open(),i.open(),s.open(),D.forEach(function(c){c.setInactive=function(){c.domElement.classList.add("control-inactive")},c.setActive=function(){c.domElement.classList.remove("control-inactive")};const g=k[c.property];(!g||!g.weight)&&c.setInactive()})}function $(t){const e=t.getClip(),n=k[e.name]||_[e.name];q(t,n.weight),t.play()}function Oe(t){L.timeScale=t}function Ne(t,e,n){W==="idle"||!t||!e?ee(t,e,n):He(t,e,n),e?W=e.getClip().name:W="None",D.forEach(function(o){o.property===W?o.setActive():o.setInactive()})}function He(t,e,n){L.addEventListener("loop",o);function o(i){i.action===t&&(L.removeEventListener("loop",o),ee(t,e,n))}}function ee(t,e,n){e?(q(e,1),e.time=0,t?t.crossFadeTo(e,n,!0):e.fadeIn(n)):t.fadeOut(n)}function q(t,e){t.enabled=!0,t.setEffectiveTimeScale(1),t.setEffectiveWeight(e)}function Ge(){F.aspect=window.innerWidth/window.innerHeight,F.updateProjectionMatrix(),v.setSize(window.innerWidth,window.innerHeight)}function te(){requestAnimationFrame(te),je()}function je(){for(let e=0;e!==V;++e){const n=U[e],o=n.getClip(),i=k[o.name]||_[o.name];i.weight=n.getEffectiveWeight()}let t=Y.getDelta();O&&(t=R,R=0),L.update(t),I.update(t),G.update(),v.render(h,F)}
