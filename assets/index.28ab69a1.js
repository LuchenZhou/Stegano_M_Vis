import{C as te,S as ne,a as oe,F as ie,H as se,D as ae,M as re,P as ce,b as le,G as de,c as R,A as j,d as D,W as fe,s as pe,e as ue,O as me,f as he,g as ge,h as we,i as ve,V as T,j as be,k as ke,l as ye,m as Se,B as U,n as P,U as xe,o as Ae}from"./vendor.8704e2d3.js";const Ce=function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))i(s);new MutationObserver(s=>{for(const o of s)if(o.type==="childList")for(const a of o.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&i(a)}).observe(document,{childList:!0,subtree:!0});function t(s){const o={};return s.integrity&&(o.integrity=s.integrity),s.referrerpolicy&&(o.referrerPolicy=s.referrerpolicy),s.crossorigin==="use-credentials"?o.credentials="include":s.crossorigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function i(s){if(s.ep)return;s.ep=!0;const o=t(s);fetch(s.href,o)}};Ce();let u,h,b,I,k,N,y,F,V;const O=[];let r=[],E=[];const M=new te(5,5,5,5,15,5,30);let w,C="idle";const z=[],v={idle:{weight:0},walk:{weight:0},run:{weight:1}},S={sneak_pose:{weight:1},sad_pose:{weight:1},agree:{weight:0},headShake:{weight:0}};let x,H;Le();function Le(){const n=document.getElementById("container");V=new ve,u=new ne,u.background=new oe(10526880),u.fog=new ie(10526880,10,50);const e=new se(16777215,4473924);e.position.set(0,20,0),u.add(e);const t=new ae(16777215);t.position.set(3,10,10),t.castShadow=!0,t.shadow.camera.top=2,t.shadow.camera.bottom=-2,t.shadow.camera.left=-2,t.shadow.camera.right=2,t.shadow.camera.near=.1,t.shadow.camera.far=40,u.add(t);const i=new re(new ce(100,100),new le({color:10066329,depthWrite:!1}));i.rotation.x=-Math.PI/2,i.receiveShadow=!0,u.add(i),new de().load("models/gltf/Xbot.glb",function(a){k=a.scene,k.position.x=1,u.add(k),k.traverse(function(c){c.isMesh&&(c.castShadow=!0)}),N=new R(k),N.visible=!1,u.add(N);const l=a.animations;F=new j(k),H=l.length;for(let c=0;c!==H;++c){let d=l[c];const g=d.name;if(v[g]){const p=F.clipAction(d);q(p),v[g].action=p,z.push(p)}else if(S[g]){D.makeClipAdditive(d),d.name.endsWith("_pose")&&(d=D.subclip(d,d.name,2,3,30));const p=F.clipAction(d);q(p),S[g].action=p,z.push(p)}}Be(),_e(),J()}),h=new fe({antialias:!0}),h.setPixelRatio(window.devicePixelRatio),h.setSize(window.innerWidth,window.innerHeight),h.outputEncoding=pe,h.shadowMap.enabled=!0,n.appendChild(h.domElement),b=new ue(45,window.innerWidth/window.innerHeight,1,100),b.position.set(-1,2,5);const o=new me(b,h.domElement);o.enablePan=!1,o.enableZoom=!0,o.target.set(0,1,0),o.update(),I=new he,n.appendChild(I.dom),window.addEventListener("resize",Oe)}function Fe(n,e){const t=r[0][0].length,i=120,s=t/i;var o=[];const a=[],l=[],c=new P;for(let f=0;f<t;f++){a.push(f/i);let L=r[0][0][f],A=r[1][0][f],W=r[2][0][f];c.set(L,A,W).toArray(l,l.length)}const d=".bones[bone_0].position",g=new T(d,a,l);o.push(g);for(let f=1;f<r[0].length;f++){const L=[],A=[],W=new P;for(let m=0;m<t;m++){L.push(m/i);let _=n[f-1],B=e[f-1],Y=r[0][B][m]-r[0][_][m],$=r[1][B][m]-r[1][_][m],ee=r[2][B][m]-r[2][_][m];W.set(Y,$,ee).toArray(A,A.length)}const Z=".bones[bone_"+f+"].position",Q=new T(Z,L,A);o.push(Q)}var p=new be("Action",s,o);y=new j(w);var X=y.clipAction(p);X.play()}function Ee(){const n=M.attributes.position,e=new P,t=[],i=[];for(let s=0;s<n.count;s++){e.fromBufferAttribute(n,s);const o=1,a=1;t.push(o,o+1,0,0),i.push(1-a,a,0,0)}M.setAttribute("skinIndex",new xe(t,4)),M.setAttribute("skinWeight",new Ae(i,4))}function Me(){Ee();const n=new ke({color:16737095,wireframe:!0});w=new ye(M,n);const e=new Se(E),t=e.bones[0];w.add(t),w.bind(e),w.position.set(0,1.15,0),w.scale.set(.07,.07,.07),u.add(w);var i=new R(w);i.visible=!0,u.add(i)}function We(n,e){var t=new U;t.name="bone_0",E.push(t);var i=r[0][0][0],s=r[1][0][0],o=r[2][0][0];t.position.set(i,s,o),console.log(t.position),console.log(r[2][2][2033]),console.log(r[0][1][0]);for(let c=1;c!==n.length+1;++c){var a=new U;E[n[c-1]].add(a),a.name="bone_"+e[c-1],E.push(a),console.log(c);var l=n[c-1];i=r[0][c][0]-r[0][l][0],s=r[1][c][0]-r[1][l][0],o=r[2][c][0]-r[2][l][0],a.position.set(i,s,o)}}function _e(){new ge().load("models/files/output.json",function(e){r=JSON.parse(e);const t=[r.length,r[0].length,r[0][0].length];console.log(t);var i=[0,1,2,3,4,5,0,7,8,9,10,11,0,13,14,15,16,17,18,15,20,21,22,23,24,25,23,27,15,29,30,31,32,33,34,32,36],s=[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37];We(i,s),Me(),Fe(i,s)},function(e){console.log(e.loaded/e.total*100+"% loaded")},function(e){console.error("An error happened")})}function Be(){const n=new we({width:310}),e=n.addFolder("Base Actions"),t=n.addFolder("Additive Action Weights"),i=n.addFolder("General Speed");x={"modify time scale":1};const s=["None",...Object.keys(v)];for(let o=0,a=s.length;o!==a;++o){const l=s[o],c=v[l];x[l]=function(){const d=v[C],g=d?d.action:null,p=c?c.action:null;Ie(g,p,.35)},O.push(e.add(x,l))}for(const o of Object.keys(S)){const a=S[o];x[o]=a.weight,t.add(x,o,0,1,.01).listen().onChange(function(l){G(a.action,l),a.weight=l})}i.add(x,"modify time scale",0,1.5,.01).onChange(Pe),e.open(),t.open(),i.open(),O.forEach(function(o){o.setInactive=function(){o.domElement.classList.add("control-inactive")},o.setActive=function(){o.domElement.classList.remove("control-inactive")};const a=v[o.property];(!a||!a.weight)&&o.setInactive()})}function q(n){const e=n.getClip(),t=v[e.name]||S[e.name];G(n,t.weight),n.play()}function Pe(n){y.timeScale=n}function Ie(n,e,t){C==="idle"||!n||!e?K(n,e,t):Ne(n,e,t),e?C=e.getClip().name:C="None",O.forEach(function(i){i.property===C?i.setActive():i.setInactive()})}function Ne(n,e,t){y.addEventListener("loop",i);function i(s){s.action===n&&(y.removeEventListener("loop",i),K(n,e,t))}}function K(n,e,t){e?(G(e,1),e.time=0,n?n.crossFadeTo(e,t,!0):e.fadeIn(t)):n.fadeOut(t)}function G(n,e){n.enabled=!0,n.setEffectiveTimeScale(1),n.setEffectiveWeight(e)}function Oe(){b.aspect=window.innerWidth/window.innerHeight,b.updateProjectionMatrix(),h.setSize(window.innerWidth,window.innerHeight)}function J(){requestAnimationFrame(J),ze()}function ze(){for(let e=0;e!==H;++e){const t=z[e],i=t.getClip(),s=v[i.name]||S[i.name];s.weight=t.getEffectiveWeight()}const n=V.getDelta();y.update(n),F.update(n),I.update(),h.render(u,b)}
