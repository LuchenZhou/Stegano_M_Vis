import{L as Ae,B as De,F as U,a as _e,V as v,b as Ce,c as Pe,d as G,M as ne,S as He,C as E,H as Me,D as Le,G as Ee,P as j,W as Fe,s as ze,e as Ve,f as We,g as Te,h as Ge,A as se,i as oe,E as Be,R as Re,j as Ie,k as Oe,O as Ue,l as je,m as Ne,n as Xe,o as Ye,p as ae,U as qe,q as Je,r as Ke,t as Ze,u as Qe,T as $e,v as et,w as tt,x as re,y as it,z as nt}from"./vendor.f9d144a5.js";const st=function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))s(i);new MutationObserver(i=>{for(const o of i)if(o.type==="childList")for(const a of o.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&s(a)}).observe(document,{childList:!0,subtree:!0});function n(i){const o={};return i.integrity&&(o.integrity=i.integrity),i.referrerpolicy&&(o.referrerPolicy=i.referrerpolicy),i.crossorigin==="use-credentials"?o.credentials="include":i.crossorigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function s(i){if(i.ep)return;i.ep=!0;const o=n(i);fetch(i.href,o)}};st();const x=new G,B=new ne,N=new ne;class ot extends Ae{constructor(e,n,s,i,o){const a=le(e),l=new De,c=[],g=[];let b=0;i||(b=1);const k=n,L=s;for(let A=0;A<a.length;A++){const p=a[A];p.parent&&p.parent.isBone&&(c.push(p.parent.position.x,p.parent.position.y,p.parent.position.z),c.push(p.position.x,p.position.y,p.position.z),g.push(k.r,k.g,k.b),g.push(L.r,L.g,L.b))}l.setAttribute("position",new U(c,3)),l.setAttribute("color",new U(g,3)),new _e().setPositions(Float32Array.from(c));const T=new v;o.getSize(T),new Ce({color:16777215,linewidth:.001,vertexColors:!0,dashed:!1,resolution:T,alphaToCoverage:!0});const f=new Pe({vertexColors:!0,linewidth:10,depthTest:!1,depthWrite:!1,toneMapped:!1,transparent:!0,opacity:b});super(l,f);this.type="SkeletonHelper",this.isSkeletonHelper=!0,this.root=e,this.bones=a,this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1}updateMatrixWorld(e){const n=this.bones,s=this.geometry,i=s.getAttribute("position");N.copy(this.root.matrixWorld).invert();for(let o=0,a=0;o<n.length;o++){const l=n[o];l.parent&&l.parent.isBone&&(B.multiplyMatrices(N,l.matrixWorld),x.setFromMatrixPosition(B),i.setXYZ(a,x.x,x.y,x.z),B.multiplyMatrices(N,l.parent.matrixWorld),x.setFromMatrixPosition(B),i.setXYZ(a+1,x.x,x.y,x.z),a+=2)}s.getAttribute("position").needsUpdate=!0,super.updateMatrixWorld(e)}}function le(t){const e=[];t&&t.isBone&&e.push(t);for(let n=0;n<t.children.length;n++)e.push.apply(e,le(t.children[n]));return e}const at={uniforms:{tDiffuse:{value:null},sourceTextureSize:{value:new v(1242,1042)},sourceTexelSize:{value:new v(1/1242,1/1042)},focusPoint:{value:new v(0,0)}},vertexShader:`
		varying vec2 vUv;
		void main() {
			vUv = uv;
			gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
		}`,fragmentShader:`
        uniform sampler2D tDiffuse;
        uniform vec2 sourceTextureSize;
        uniform vec2 sourceTexelSize;
        uniform vec2 focusPoint;

		varying vec2 vUv;

        void main(void) {
            vec4 c = texture2D(tDiffuse,vUv);
            vec4 dc = c;
          
            // only dilate to the right of the mouse
            if (vUv.x > focusPoint.x)
            {
              vec3 cc;
              //read out the texels
              for (int i=-1; i <= 1; ++i)
              {
                for (int j=-1; j <= 1; ++j)
                {
                  // color at pixel in the neighborhood
                  vec2 coord = vUv.xy + vec2(float(i), float(j))*sourceTexelSize.xy;
                  cc = texture2D(tDiffuse, coord).rgb;
          
                  // dilate = max, erode = min
                  dc.rgb = max(cc.rgb, dc.rgb);
                }
              }
            }
          
            gl_FragColor = dc;
          }
        `},y=function(t,e,n,s,i,o,a,l,c){this.path=t,this.animData=null,this.location_x=e,this.location_y=n,this.location_z=s,this.head=null,this.tail=null,this.bones=[],this.showVis=i,this.partialhuman=c,this.fakeMeshGeometry=new Xe(5,5,5,5,15,5,30),this.mesh=null,this.meshScale=1,this.skeleton=null,this.boneVisHelper=null,this.verticesVisHelper=null,this.isReConstructed=o,this.color1=new E(0,0,1),this.color2=new E(0,1,0),this.isReConstructed&&(this.color1=new E(1,0,0),this.color2=new E(1,.5,0)),this.transparentBone=!1,a&&(this.transparentBone=!0),this.transparentVertices=!1,l&&(this.transparentVertices=!0),this.Label=null,this.tracks=[],this.clip=null,this.mixer=null,this.clipAction=null};y.prototype={constructor:y,initContent:function(){this._reportProgress({detail:{text:"Loading: "+this.path}});const t=new Ye,e=this,n=function(s){console.log("Loading complete: "+e.path),e._reportProgress({detail:{text:""}}),e.animData=JSON.parse(s);const i=[e.animData.length,e.animData[0].length,e.animData[0][0].length];console.log(i),i[1]===21?(e.head=[0,1,2,3,0,5,6,7,0,9,10,11,0,13,14,15,0,17,18,19],e.tail=[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20]):i[1]===38&&e.partialhuman?(e.head=[0,1,2,3,4,5,0,7,8,9,10,11,0,13,14,15,16,17,18,15],e.tail=[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20],e.meshScale=1):(e.head=[0,1,2,3,4,5,0,7,8,9,10,11,0,13,14,15,16,17,18,15,20,21,22,23,24,25,23,27,15,29,30,31,32,33,34,32,36],e.tail=[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37],e.meshScale=1),e.createSkeleton(),e.createFakeSkinMesh(),e.createSkinMesh(),e.setUpAnimation()};t.load(e.path,n)},loadDataFromFile:function(t){this.animData=JSON.parse(t);const e=[this.animData.length,this.animData[0].length,this.animData[0][0].length];console.log(e),e[1]===21?(this.head=[0,1,2,3,0,5,6,7,0,9,10,11,0,13,14,15,0,17,18,19],this.tail=[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20]):(this.head=[0,1,2,3,4,5,0,7,8,9,10,11,0,13,14,15,16,17,18,15,20,21,22,23,24,25,23,27,15,29,30,31,32,33,34,32,36],this.tail=[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37],this.meshScale=.07),this.createSkeleton(),this.createFakeSkinMesh(),this.createSkinMesh(),this.setUpAnimation()},_reportProgress:function(t){let e="";t.detail!==null&&t.detail!==void 0&&t.detail.text&&(e=t.detail.text),console.log("Progress: "+e)},createSkeleton:function(){let t=new ae;t.name="bone_0",this.bones.push(t);let e=[],n=this.animData[0][0][0],s=this.animData[1][0][0],i=this.animData[2][0][0];t.position.set(n,s,i),e.push(t.position);for(let o=1;o!==this.head.length+1;++o){let a=new ae;this.bones[this.head[o-1]].add(a),a.name="bone_"+this.tail[o-1],this.bones.push(a);let l=this.head[o-1];n=this.animData[0][o][0]-this.animData[0][l][0],s=this.animData[1][o][0]-this.animData[1][l][0],i=this.animData[2][o][0]-this.animData[2][l][0],a.position.set(n,s,i),e.push(a.position)}},createFakeSkinMesh:function(){const t=this.fakeMeshGeometry.attributes.position,e=new G,n=[],s=[];for(let i=0;i<t.count;i++){e.fromBufferAttribute(t,i);const o=1,a=1;n.push(o,o+1,0,0),s.push(1-a,a,0,0)}this.fakeMeshGeometry.setAttribute("skinIndex",new qe(n,4)),this.fakeMeshGeometry.setAttribute("skinWeight",new U(s,4))},createSkinMesh:function(){const t=new Je({color:16737095,wireframe:!0});this.mesh=new Ke(this.fakeMeshGeometry,t),this.skeleton=new Ze(this.bones);const e=this.skeleton.bones[0];this.mesh.add(e),this.mesh.visible=!1,this.mesh.bind(this.skeleton),this.mesh.position.set(this.location_x,this.location_y,this.location_z),this.mesh.scale.set(this.meshScale,this.meshScale,this.meshScale),m.add(this.mesh),this.boneVisHelper=new ot(this.mesh,this.color1,this.color2,this.transparentBone,u),this.boneVisHelper.visible=this.showVis,m.add(this.boneVisHelper),console.log(this.boneVisHelper);const n=new Qe({color:this.color2,size:10,sizeAttenuation:!1,map:new $e().load("disc.png"),alphaTest:.5});this.verticesVisHelper=new et(this.boneVisHelper.geometry,n),this.boneVisHelper.add(this.verticesVisHelper),this.transparentVertices&&(this.verticesVisHelper.material.opacity=0);const s=document.createElement("div");s.className="label",s.textContent="Text",s.style.color=this.color2.getStyle(),s.style.marginTop="-1em",this.Label=new tt(s),this.Label.position.copy(this.mesh.position),this.Label.visible=!1,this.boneVisHelper.add(this.Label)},setUpAnimation:function(){const t=this.animData[0][0].length,e=t===24?24:120,n=t/e,s=[],i=[],o=new G;for(let c=0;c<t;c++){s.push(c/e);let g=this.animData[0][0][c],b=this.animData[1][0][c],k=this.animData[2][0][c];o.set(g,b,k).toArray(i,i.length)}const a=".bones[bone_0].position",l=new re(a,s,i);this.tracks.push(l);for(let c=1;c<this.head.length;c++){const g=[],b=[],k=new G;for(let f=0;f<t;f++){g.push(f/e);let A=this.head[c-1],p=this.tail[c-1],ye=this.animData[0][p][f]-this.animData[0][A][f],Se=this.animData[1][p][f]-this.animData[1][A][f],ke=this.animData[2][p][f]-this.animData[2][A][f];k.set(ye,Se,ke).toArray(b,b.length)}const L=".bones[bone_"+c+"].position",T=new re(L,g,b);this.tracks.push(T)}this.clip=new it("Action",n,this.tracks),this.mixer=new se(this.mesh),this.clipAction=this.mixer.clipAction(this.clip),this.clipAction.play(),H.push(this.clipAction),J.push(this.mixer)}};let m,u,h,X,S,_,C,Y="Perspective",F,q,R,ce,rt=[],w=[],P=[];const J=[],H=[],d=[];let D,z="human";const he=4;let M;const K=[],V={idle:{weight:1},walk:{weight:0},run:{weight:0}},I={sneak_pose:{weight:0},sad_pose:{weight:0},agree:{weight:0},headShake:{weight:0}};let r,Z;lt();let O=!1,Q=0;ct();const de=new y("models/files/Mix/OursGated_cover_uncorrupted.json",.5,.3,0,!0,!1,!1);de.initContent();d.push(de);const ue=new y("models/files/Mix/OursGated_recon_cover_corrupted.json",.5,.3,0,!0,!0,!1,!1);ue.initContent();d.push(ue);const pe=new y("models/files/Baluja_secret_uncorrupted.json",-.5,1.15,0,!0,!1,!1,!1,!0);pe.initContent();d.push(pe);const fe=new y("models/files/Baluja_recon_secret_corrupted.json",-.5,1.15,0,!0,!0,!1,!1);fe.initContent();d.push(fe);function lt(){const t=document.getElementById("container");document.getElementById("file1").addEventListener("change",_t,!1),document.getElementById("file2").addEventListener("change",Ct,!1),ce=new nt,m=new He,m.background=new E(4473924),new Me(16777215,4473924).position.set(0,20,0);const n=new Le(16777215);n.position.set(3,10,10),n.castShadow=!0,n.shadow.camera.top=2,n.shadow.camera.bottom=-2,n.shadow.camera.left=-2,n.shadow.camera.right=2,n.shadow.camera.near=.1,n.shadow.camera.far=40,C=new Ee(20,20,8947848),m.add(C);const s=window.innerWidth,i=window.innerHeight;h=new j(45,s/i,1,100),h.position.set(0,1,3),u=new Fe({antialias:!0}),u.setPixelRatio(window.devicePixelRatio),u.setSize(window.innerWidth,window.innerHeight),u.outputEncoding=ze,u.shadowMap.enabled=!0,t.appendChild(u.domElement),me(),we(),S=new Ve,S.setSize(window.innerWidth,window.innerHeight),S.domElement.style.position="absolute",S.domElement.style.top="0px",S.domElement.style.pointerEvents="none",t.appendChild(S.domElement),X=new We,t.appendChild(X.dom),window.addEventListener("resize",Pt)}function ct(){new Te().load("models/gltf/Xbot.glb",function(e){F=e.scene,m.add(F),F.traverse(function(s){s.isMesh&&(s.castShadow=!0),s.isMesh&&(s.visible=!1)}),q=new Ge(F),q.visible=!1,m.add(q);const n=e.animations;R=new se(F),Z=n.length;for(let s=0;s!==Z;++s){let i=n[s];const o=i.name;if(V[o]){const a=R.clipAction(i);ve(a),V[o].action=a,K.push(a)}else if(I[o]){oe.makeClipAdditive(i),i.name.endsWith("_pose")&&(i=oe.subclip(i,i.name,2,3,30));const a=R.clipAction(i);ve(a),I[o].action=a,K.push(a)}}ht(),xe()})}function me(){_=new Be(u);const t=new Re(m,h);_.addPass(t),M=new Ie(at),M.uniforms.sourceTextureSize.value=new v(window.innerWidth,window.innerHeight),M.uniforms.sourceTexelSize.value=new v(1.5/window.innerWidth,1.5/window.innerHeight),_.addPass(M);const e=new Oe(window.innerWidth*u.getPixelRatio(),window.innerHeight*u.getPixelRatio());_.addPass(e)}function we(){D=new Ue(h,u.domElement),D.enablePan=!0,D.autoRotate=!0,D.target.set(0,1,0),D.update()}function ht(){const t=new je({width:310}),e=t.addFolder("Visibility"),n=t.addFolder("Camera Controls"),s=t.addFolder("Activation/Deactivation"),i=t.addFolder("Pause Stepping"),o=t.addFolder("General Speed"),a=t.addFolder("Scale and Pos");r={"show hand demo":function(){ee("hand"),z="hand"},"show human demo":function(){ee("human"),z="human"},"clear all scene object":function(){ee("None"),z="None"},"camera rotate":!0,"set photo mode":!1,"modify time scale":1,"deactivate all":bt,"activate all":vt,"pause/continue":xt,"make single step":St,"modify step size":.05,"set Grid scale":1,"set Grid XY":1,"set Obj Rotate Angle":1,"bone opacity (transparent)":1,"vertices opacity (transparent)":1,"show/disable label":!1,"show/disable dilation(post-process)":!0,"perspective camera":$,"orthographic camera":$},w.push(e.add(r,"show hand demo")),w.push(e.add(r,"show human demo")),w.push(e.add(r,"clear all scene object")),n.add(r,"camera rotate").onChange(ge),n.add(r,"set photo mode").onChange(pt),P.push(n.add(r,"perspective camera")),P.push(n.add(r,"orthographic camera")),e.add(r,"bone opacity (transparent)",0,1,1).onChange(ut),e.add(r,"vertices opacity (transparent)",0,1,1).onChange(dt),e.add(r,"show/disable label").onChange(W),e.add(r,"show/disable dilation(post-process)"),s.add(r,"deactivate all"),s.add(r,"activate all"),i.add(r,"pause/continue"),i.add(r,"make single step"),i.add(r,"modify step size",.01,.1,.001),o.add(r,"modify time scale",0,1.5,.01).onChange(gt),a.add(r,"set Grid scale",.01,3,.01).onChange(ft),a.add(r,"set Grid XY",.01,2,.01).onChange(mt),a.add(r,"set Obj Rotate Angle",.01,4,.01).onChange(wt),e.open(),s.open(),i.open(),o.open(),a.open(),rt.forEach(function(l){l.setInactive=function(){l.domElement.classList.add("control-inactive")},l.setActive=function(){l.domElement.classList.remove("control-inactive")};const c=V[l.property];(!c||!c.weight)&&l.setInactive()})}function W(t){d.forEach(function(e){e.boneVisHelper.visible===!0&&(e.Label.visible=t)})}function dt(t){d.forEach(function(e){e.verticesVisHelper.material.opacity=t})}function ut(t){d.forEach(function(e){e.boneVisHelper.material.opacity=t})}function ge(t){D.autoRotate=t,h.position.set(0,1,3)}function pt(t){t?($(),C.rotation.x=Math.PI/2):C.rotation.x=Math.PI}function $(){h instanceof j?(h=new Ne(window.innerWidth/-1e3,window.innerWidth/1e3,window.innerHeight/1e3,window.innerHeight/-1e3,1,10),h.position.x=0,h.position.y=1,h.position.z=3,Y="Orthographic"):(h=new j(45,window.innerWidth/window.innerHeight,.1,1e3),h.position.x=0,h.position.y=1,h.position.z=3,Y="Perspective"),me(),we(),ge(!1)}function ee(t){t==="hand"?d.forEach(function(e){e.tail.length===20?(e.boneVisHelper.visible=!0,W(r["show/disable label"])):(e.boneVisHelper.visible=!1,e.Label.visible=!1,W(r["show/disable label"]))}):t==="human"?d.forEach(function(e){e.tail.length!==20?(e.boneVisHelper.visible=!0,W(r["show/disable label"])):(e.boneVisHelper.visible=!1,e.Label.visible=!1,W(r["show/disable label"]))}):d.forEach(function(e){e.boneVisHelper.visible=!1,e.Label.visible=!1,e.path==="dummy/path"&&ie(e)})}function ft(t){C.scale.set(t,t,t)}function mt(t){C.position.set(t,t,0)}function wt(t){d.forEach(function(e){e.mesh.rotation.set(0,t,0)})}function gt(t){for(const e of J)e.timeScale=t}function bt(){H.forEach(function(t){t.stop()})}function vt(){H.forEach(function(t){t.play()})}function xt(){O?(O=!1,te()):H[0].paused?te():yt()}function yt(){H.forEach(function(t){t.paused=!0})}function te(){H.forEach(function(t){t.paused=!1})}let be=0;function St(){te(),O=!0,Q=r["modify step size"],be+=1,console.log(be)}function ve(t){const e=t.getClip(),n=V[e.name]||I[e.name];kt(t,n.weight),t.play()}function kt(t,e){t.enabled=!0,t.setEffectiveTimeScale(1),t.setEffectiveWeight(e)}function ie(t){t.mesh.removeFromParent(),t.boneVisHelper.removeFromParent(),m.remove(t),console.log(t.path+"has been remove"),console.log(d)}function At(){z==="hand"?(w[0].disable(),w[1].enable()):z==="human"?(w[0].enable(),w[1].disable()):(w[0].enable(),w[1].enable())}function Dt(){Y==="Perspective"?(P[0].disable(),P[1].enable()):(P[1].disable(),P[0].enable())}function _t(t){var e=t.target.files[0],n=new FileReader;n.onload=function(s){return function(i){const o=new y("dummy/folder_1",.5,1.15,0,!0,!1);if(o.loadDataFromFile(n.result),d.length>=he+2){let a=d.splice(-2,1);ie(a[0])}d.push(o)}}(),n.readAsText(e)}function Ct(t){var e=t.target.files[0],n=new FileReader;n.onload=function(s){return function(i){const o=new y("dummy/folder_2",-.5,.75,0,!0,!1);if(o.loadDataFromFile(n.result),d.length>=he+2){let a=d.splice(-2,1);ie(a[0])}d.push(o)}}(),n.readAsText(e)}function Pt(){h.aspect=window.innerWidth/window.innerHeight,h.updateProjectionMatrix(),u.setSize(window.innerWidth,window.innerHeight),_.setSize(window.innerWidth,window.innerHeight),M.uniforms.sourceTextureSize.value=new v(window.innerWidth,window.innerHeight),M.uniforms.sourceTexelSize.value=new v(1/window.innerWidth,1/window.innerHeight),S.setSize(window.innerWidth,window.innerHeight)}function Ht(){X.update(),S.render(m,h),r["show/disable dilation(post-process)"]?_.render():u.render(m,h)}function xe(){requestAnimationFrame(xe);for(let e=0;e!==Z;++e){const n=K[e],s=n.getClip(),i=V[s.name]||I[s.name];i.weight=n.getEffectiveWeight()}Dt(),At(),D.update();let t=ce.getDelta();O&&(t=Q,Q=0),R.update(t);for(const e of J)e.update(t);Ht()}
